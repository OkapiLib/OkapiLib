<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2D Motion Profiling | OkapiLib A PROS library for programming VEX robots</title>
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="okapi-docs.css" />
  <link rel="icon" href="logo-doxygen.jpeg" type="image/jpeg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OkapiLib <span class="m-thin">A PROS library for programming VEX robots</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path d="m6 0c-3.3144 0-6 2.6856-6 6 0 3.3144 2.6856 6 6 6 1.4858 0 2.8463-0.54083 3.8945-1.4355-0.0164 0.33797 0.14734 0.75854 0.5 1.1504l3.2227 3.7891c0.55185 0.6139 1.4517 0.66544 2.002 0.11524 0.55022-0.55022 0.49866-1.4501-0.11524-2.002l-3.7891-3.2246c-0.39184-0.35266-0.81242-0.51469-1.1504-0.5 0.89472-1.0482 1.4355-2.4088 1.4355-3.8945 0-3.3128-2.6856-5.998-6-5.998zm0 1.5625a4.4375 4.4375 0 0 1 4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375-4.4375 4.4375 4.4375 0 0 1 4.4375-4.4375z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="md_docs_tutorials_index.html">Tutorials</a></li>
            <li>
              <a href="md_docs_api_index.html">API</a>
              <ol>
                <li><a href="md_docs_api_chassis.html">Chassis API</a></li>
                <li><a href="md_docs_api_control.html">Control API</a></li>
                <li><a href="md_docs_api_devices.html">Devices API</a></li>
                <li><a href="md_docs_api_filters.html">Filters API</a></li>
                <li><a href="md_docs_api_units.html">Units API</a></li>
                <li><a href="md_docs_api_utility.html">Utility API</a></li>
              </ol>
            </li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="annotated.html">Classes</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <path d="m6 0c-3.3144 0-6 2.6856-6 6 0 3.3144 2.6856 6 6 6 1.4858 0 2.8463-0.54083 3.8945-1.4355-0.0164 0.33797 0.14734 0.75854 0.5 1.1504l3.2227 3.7891c0.55185 0.6139 1.4517 0.66544 2.002 0.11524 0.55022-0.55022 0.49866-1.4501-0.11524-2.002l-3.7891-3.2246c-0.39184-0.35266-0.81242-0.51469-1.1504-0.5 0.89472-1.0482 1.4355-2.4088 1.4355-3.8945 0-3.3128-2.6856-5.998-6-5.998zm0 1.5625a4.4375 4.4375 0 0 1 4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375-4.4375 4.4375 4.4375 0 0 1 4.4375-4.4375z"/>
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          2D Motion Profiling
        </h1>
<p>Motion Profiling is a controls algorithm that defines a movement as a series of steps. In one dimension, it defines a motor&#x27;s position, speed, acceleration, etc. at every timestep during the movement. In two dimensions, it defines your robot&#x27;s position, speed, acceleration, etc. and heading at every timestep during the movement.</p><p>There is a lot of interesting math that goes into calculating these values, which you can learn about in examples like these:</p><ul><li><a href="http://www2.informatik.uni-freiburg.de/~lau/students/Sprunk2008.pdf">http:/<wbr />/<wbr />www2.informatik.uni-freiburg.de/<wbr />~lau/<wbr />students/<wbr />Sprunk2008.pdf</a></li><li><a href="https://github.com/AtsushiSakai/PythonRobotics/blob/master/PathPlanning/QuinticPolynomialsPlanner/animation.gif">https:/<wbr />/<wbr />github.com/<wbr />AtsushiSakai/<wbr />PythonRobotics/<wbr />blob/<wbr />master/<wbr />PathPlanning/<wbr />QuinticPolynomialsPlanner/<wbr />animation.gif</a></li><li><a href="https://www.dis.uniroma1.it/~deluca/rob1_en/13_TrajectoryPlanningJoints.pdf">https://www.dis.uniroma1.it/~deluca/rob1_<wbr />en/13_<wbr />TrajectoryPlanningJoints.pdf</a></li></ul><p>OkapiLib, through <a href="https://github.com/JacisNonsense/Pathfinder">Pathfinder</a>, does this math for you and ties both the motion profiling and profile following actions to the same <a href="md_docs_tutorials_walkthrough_asyncAutonomousMovement.html" class="m-doc">async controllers</a> that are used for other simpler movements. Because OkapiLib&#x27;s motion profile generation uses <a href="https://github.com/JacisNonsense/Pathfinder">Pathfinder</a>, there are a few open issues you should know about:</p><ul><li>Pathfinder cannot generate negative velocities, so generating backward movements and very tight turns do not work<ul><li>Moving backwards: <a href="https://github.com/JacisNonsense/Pathfinder/issues/39">https:/<wbr />/<wbr />github.com/<wbr />JacisNonsense/<wbr />Pathfinder/<wbr />issues/<wbr />39</a></li><li>Tight turns: <a href="https://github.com/JacisNonsense/Pathfinder/issues/38">https:/<wbr />/<wbr />github.com/<wbr />JacisNonsense/<wbr />Pathfinder/<wbr />issues/<wbr />38</a></li></ul></li><li>Very long movements (typically movements much longer than a VEX field) can potentially never reach maximum speed: <a href="https://github.com/JacisNonsense/Pathfinder/issues/43">https:/<wbr />/<wbr />github.com/<wbr />JacisNonsense/<wbr />Pathfinder/<wbr />issues/<wbr />43</a></li></ul><blockquote><p>Even though OkapiLib cannot generate paths that move backwards, it can still <strong>follow</strong> a path backwards. To do this, there are parameters in <a href="classokapi_1_1AsyncMotionProfileController.html#a2846d2e36b86b39aa2e761e4e34cd225" class="m-doc">setTarget</a> that allow you to follow a path backwards and optionally mirror the path.</p></blockquote><p>First, let&#x27;s initialize a <a href="classokapi_1_1ChassisController.html" class="m-doc">ChassisController</a> to pass into the <a href="classokapi_1_1AsyncMotionProfileControllerBuilder.html" class="m-doc">AsyncMotionProfileControllerBuilder</a>:</p><blockquote><p>The &quot;linear&quot; properties of the chassis given to <a href="classokapi_1_1AsyncMotionProfileControllerBuilder.html#a5808aa809738b4249e4f8551a423dc10" class="m-doc">AsyncMotionProfileControllerBuilder::<wbr />withLimits</a> are for its forward/backwards movements, not the maximum properties for turning or other movements.</p></blockquote><pre class="m-code"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ChassisController</span><span class="o">&gt;</span> <span class="n">myChassis</span> <span class="o">=</span>
  <span class="n">ChassisControllerBuilder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">withMotors</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">-3</span><span class="p">,</span> <span class="mi">-4</span><span class="p">})</span>
    <span class="c1">// Green gearset, 4 in wheel diam, 11.5 in wheel track</span>
    <span class="p">.</span><span class="n">withDimensions</span><span class="p">(</span><span class="n">AbstractMotor</span><span class="o">::</span><span class="n">gearset</span><span class="o">::</span><span class="n">green</span><span class="p">,</span> <span class="p">{{</span><span class="mi">4</span><span class="n">_in</span><span class="p">,</span> <span class="mf">11.5</span><span class="n">_in</span><span class="p">},</span> <span class="n">imev5GreenTPR</span><span class="p">})</span>
    <span class="p">.</span><span class="n">build</span><span class="p">();</span>

<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">AsyncMotionProfileController</span><span class="o">&gt;</span> <span class="n">profileController</span> <span class="o">=</span>
  <span class="n">AsyncMotionProfileControllerBuilder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">withLimits</span><span class="p">({</span>
      <span class="mf">1.0</span><span class="p">,</span> <span class="c1">// Maximum linear velocity of the Chassis in m/s</span>
      <span class="mf">2.0</span><span class="p">,</span> <span class="c1">// Maximum linear acceleration of the Chassis in m/s/s</span>
      <span class="mf">10.0</span> <span class="c1">// Maximum linear jerk of the Chassis in m/s/s/s</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="n">withOutput</span><span class="p">(</span><span class="n">myChassis</span><span class="p">)</span>
    <span class="p">.</span><span class="n">buildMotionProfileController</span><span class="p">();</span></pre><p>Next, let&#x27;s create a motion profile. A profile is created with a list of points and a name. Each of the points contains the desired coordinates and heading. The points given to the controller form a path from the first given point to the last, with the first point assumed to be the current position of the robot. The path will be generated assuming that all of the points are relative to the first, so if you pass in an x value of <code>-4_ft</code> for the first point, then passing an x value of <code>0_ft</code> for the second point will result in a forward movement of <code>4</code> feet.</p><blockquote><p>This function computes the set of steps for the desired profile, which may take some time.</p></blockquote><pre class="m-code"><span class="n">profileController</span><span class="o">-&gt;</span><span class="n">generatePath</span><span class="p">({</span>
  <span class="p">{</span><span class="mi">0</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_deg</span><span class="p">},</span>  <span class="c1">// Profile starting position, this will normally be (0, 0, 0)</span>
  <span class="p">{</span><span class="mi">3</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_deg</span><span class="p">}},</span> <span class="c1">// The next point in the profile, 3 feet forward</span>
  <span class="s">&quot;A&quot;</span> <span class="c1">// Profile name</span>
<span class="p">);</span></pre><p>After the profile is created, it is added to a map of available profiles stored in the controller. You can then set a target using the name you gave the profile.</p><pre class="m-code"><span class="n">profileController</span><span class="o">-&gt;</span><span class="n">setTarget</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span></pre><p>And then as with any <a href="classokapi_1_1AsyncController.html" class="m-doc">AsyncController</a>, you can call <a href="classokapi_1_1AsyncController.html#a20e19f334e3dc7a3092e0e4355edcf49" class="m-doc">AsyncController::<wbr />waitUntilSettled</a> to block program execution until the movement is finished and the robot reaches the desired end point.</p><pre class="m-code"><span class="n">profileController</span><span class="o">-&gt;</span><span class="n">waitUntilSettled</span><span class="p">();</span></pre><h3>Wrap-up</h3><p>In total, here is how to initialize and use a 2D motion profiling controller:</p><pre class="m-code"><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ChassisController</span><span class="o">&gt;</span> <span class="n">myChassis</span> <span class="o">=</span>
  <span class="n">ChassisControllerBuilder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">withMotors</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">-3</span><span class="p">,</span> <span class="mi">-4</span><span class="p">})</span>
    <span class="c1">// Green gearset, 4 in wheel diam, 11.5 in wheel track</span>
    <span class="p">.</span><span class="n">withDimensions</span><span class="p">(</span><span class="n">AbstractMotor</span><span class="o">::</span><span class="n">gearset</span><span class="o">::</span><span class="n">green</span><span class="p">,</span> <span class="p">{{</span><span class="mi">4</span><span class="n">_in</span><span class="p">,</span> <span class="mf">11.5</span><span class="n">_in</span><span class="p">},</span> <span class="n">imev5GreenTPR</span><span class="p">})</span>
    <span class="p">.</span><span class="n">build</span><span class="p">();</span>

<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">AsyncMotionProfileController</span><span class="o">&gt;</span> <span class="n">profileController</span> <span class="o">=</span> 
  <span class="n">AsyncMotionProfileControllerBuilder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">withLimits</span><span class="p">({</span>
      <span class="mf">1.0</span><span class="p">,</span> <span class="c1">// Maximum linear velocity of the Chassis in m/s</span>
      <span class="mf">2.0</span><span class="p">,</span> <span class="c1">// Maximum linear acceleration of the Chassis in m/s/s</span>
      <span class="mf">10.0</span> <span class="c1">// Maximum linear jerk of the Chassis in m/s/s/s</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="n">withOutput</span><span class="p">(</span><span class="n">myChassis</span><span class="p">)</span>
    <span class="p">.</span><span class="n">buildMotionProfileController</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">profileController</span><span class="o">-&gt;</span><span class="n">generatePath</span><span class="p">(</span>
    <span class="p">{{</span><span class="mi">0</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_deg</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_ft</span><span class="p">,</span> <span class="mi">0</span><span class="n">_deg</span><span class="p">}},</span> <span class="s">&quot;A&quot;</span><span class="p">);</span>
  <span class="n">profileController</span><span class="o">-&gt;</span><span class="n">setTarget</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
  <span class="n">profileController</span><span class="o">-&gt;</span><span class="n">waitUntilSettled</span><span class="p">();</span>
<span class="p">}</span></pre>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>OkapiLib A PROS library for programming VEX robots. Created with <a href="https://doxygen.org/">Doxygen</a> 1.8.13 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
